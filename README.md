# Игра «Найди свой ОКВЭД по номеру телефона»
## Запуск приложения
Для запуска приложения необходим интерпретатор python версии `3.12.7` с установленным пакетным менеджером `uv`.
Перед стартом приложения нужно активировать виртуальное окружение проекта и установить на него зависимости, выполнив следующие команды в терминале, находясь в директории проекта.

Команда ативации окружения в **Linux**:
```bash
source ./.venv/bin/activate
```
В **Windows**:
```PowerShell
.\venv\Scripts\activate
```

Если в системе доступна утилита `make`, можно запустить приложение, используя таргет run с параметром phone:
```bash
make run phone=+79123456781
```
Иначе можно запустить его, используя команду python:
```bash
python -m src +79123456781
```
## Логика работы приложения
Приложение реализует интерфейс командной строки, используя библиотеку `typer`. Номер телефона передаётся в него в виде параметра командной строки.

#### 1. Нормализация номера телефона
происходит без использования регулярных выражений. В её начале происходят проверки корректности переданного номера.
Номер считается корректным, если он содержит 11 цифр. При этом перед первой цифрой (непосредственно перед ней или за несколько знаков до неё) может быть знак плюс. Если в начале номера есть знак плюс, значит, первой цифрой номера должна быть "7", иначе первой цифрой номера должна быть "8". Второй цифрой номера всегда должна быть "9". Между знаком плюс и цифрами, до и после них может быть любое количество нецифровых символов - они устраняются из номера при его нормализации. Если номер не корректен, приложение выводит соответствующее сообщение в консоль и прекращает работу. Иначе нормализованные номер сохраняется в переменную и используется в дальнейшем поиске максимально совпадющего кода ОКВЭД.

#### 2. Получение актуальных кодов ОКВЭД
Происходит либо из локального файла, либо из github. Актуальность содержимого локального файла проверяется через сверку etag соответствующего JSON файла, который тоже хранится локально (совершается специальный http-запрос). Если оказывается, что локальные ОКВЭД не актуальны, локальные файлы с etag и с ОКВЭД обновляются из github.
Если оказалось так, что локальный etag актуален, но по какой-то причине локального файла ОКВЭД нет или он не доступен, файлы с etag и ОКВЭД обновляются.

#### 3. Поиск максимально совпадающего с переданным номером телефона кода ОКВЭД
Предпочтение отдаётся полностью совпавшим с последними цифрами номера кодам. Если таких кодов несколько - будет выбран самый длинный из них. Если полностью совпавших кодов не найдено, будет возвращен код с наибольшим числом совпавших идущих с конца цифр. Если никаких совпадений не найдено, будет выбран первый код ненулевой длины.

#### 4. Формирование ответного сообщения
После того, как переданный в качестве параметра номер телефона нормализован и найден масимально совпадающий с ним код, формируется и выводится ответное консольно сообщение, содержащее длину совпадения, выбранный Код ОКВЭД, его название, информацию о том, является ли совпадение полным.
В случае каких либо ошибок, ответное сообщение приложение отразит их.

## Cтиль кода
Я старался сделать стиль данного приложения чистым: развёрнутым, легко читаемым, поддерживаемым и тестируемым.
### выразительность имён
 я использовал выразительные конкретные имена классов, методов и переменных. 
### нет docstrings
Я намеренно избегал использования docstrings, так как они имеют обыкновение устаревать по мере развития проекта. Всю нужную информацию о сути методов можно получить из их сигнатур.

### pep8 и ruff
Я придерживался стандарта `pep8` и набора правил `flake8` реализованных линтером `ruff`.

### нет f-строк и статических методов
Хотя линтер `wemake-python-styleguide` не использовался в проекте, я применил в коде некоторые отраженные в нём принципы: я избегал использования f-строк (поскольку в них несколько действий происходят одновременно) и использования статических методов классов (так как их ничто не связывает с их классами, кроме имени), вместо них я использовал обычные функции.

### повторы кода в тестах
Приоритетным в тестах для меня была их читаемость, поэтому я оставил некоторые небольшие повторы кода связанного с подготовкой данных для тестов, особенно словарей ОКВЭД. В дальнейшем можно будет переработать код тестов, например, вынеся подготовку данных в фикстуры.

## Слоистая архитектура

Я написал данное приложение в слоистой архитектре. Логика работы с данными (клиент github и репозиторий для работы с локальными файлами) принадлежат одному слою - слою репозиториев, бизнес-логика (нормализация номера телефона и поиск совпадающих с ним кодов ОКВЭД) второму - слою сервисов, получение входных данных и формирование ответа - слою представлений. Это позволило сделать код упорядоченным и легко тестируемым. Хотя в проекте я не использовал каких-либо специальных инструментов для инъекции зависимостей, зависимости передаются в параметры методов инициализации объектов и разрешаются в файле `deps.py`, а при тестировании в фикстурах или в самих тестах.

## Проверка актуальности ОКВЭД. YAGNY?
Возможно, задание не предполагало кэширования кодов ОКВЭД и проверку актуальности кэша. Но в то же время из-за упоминания о регулярном обновлении файла с кодами в githab оно говорит об этом неявно.
В ситуации колективной разработки я бы уточнил это требование у коллег. Здесь я выполнил задание, так как его понял.

## ~~Тесты клиента github~~
#### ~~TODO: mock методов http-клиентаа~~
~~Для быстроты и удобства отладки приложения я пока не делал mock методов http-клиента github API, но это желательно сделать, так как сейчас тесты клиента проверяют работу внешнего API.~~

## Как можно улучшить и развить приложение
+ #### **~~Обязательно сделать mock ответов от gihub API в тестах, поскольку тестировать внешний API - не правильно!~~**
+ добавить более детальную обработку исключений (особенно исключений I/O-операций);
+ добавить детальную настройку логирования;
+ увеличить покрытие кода тестами;
+ улучшить организацию тестов (например, вынести фикстуры в отдельные файлы);
+ можно контейнеризировать приложение, используя Docker, тогда единственными требованиями к его запуску будет присутствие в системе Docker и подключение к интернету;
+ можно написать телеграм-бот как альтернативный вариант пользовательского интерфейса;
+ можно написать веб приложение с эндпойнтом для получения совпадающего с переданным номером телефона кодом ОКВЭД;

#### <div align="right">10 декабря 2025 19:29</div>

## P.S.
+ сделал mock ответов от gihub API в тестах, теперь реальные http-запросы
в тестах не выполняются.

#### <div align="right">10 декабря 2025 22:56</div>